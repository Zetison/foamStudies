#!/bin/sh
name=${1:-cylinder}
pathToFolder="$HOME/OpenFOAM/OpenFOAM-v1912/run/$name"
rm -r -f $pathToFolder
mkdir -p $pathToFolder
cp -r ./* $pathToFolder
cd $pathToFolder

nu="2.0e-02"     # kinematic viscosity
#nu="18.6e-06"   # kinematic viscosity of air at 25Â°C
end_time=1000    # End time for simulation
np=6             # Number of processors
D=2.0            # Diameter of cylinder
M=8              # Mesh number: M = 1, 2, 3, ...
delta_t="0.01"   # Discretization time step
omega_rot="0.0"  # Angular velocity of cylinder rotation
u_inf=1.0        # incident velocity speed
nRe_0=10				 # minimum number of elements withing D/sqrt(Re) outside cylinder
g++ generate_blockMeshDict_file.c -o generate_blockMeshDict_file
./generate_blockMeshDict_file $D $nu $M $nRe_0 $np $omega_rot $u_inf $delta_t $end_time
blockMesh

#pisoFoam

decomposePar
mpirun -np $np pisoFoam -parallel
reconstructPar
postProcess -func vorticity
python3.7 convertDatToCSV.py
python3.7 exportResults.py && cat results.txt 
paraFoam --script=postProcScript.py

#cd system && mv blockMeshDict temp && mv blockMeshDict_old blockMeshDict && mv temp blockMeshDict_old && cd ..

#for (( n=0; n<$np; n++ ))
#do
#  cd processor$n && foamToVTK && cd ..
#done
#paraFoam
