#!/bin/bash
MODEL_NAME="cylinder"
NP=4    	# Number of processors
name=${1:-$MODEL_NAME}
for MESH in 7
do
	pathToFolder="$HOME/OpenFOAM/OpenFOAM-v1912/run/"$name"_MESH_"$MESH
	rm -rf $pathToFolder/*
	mkdir -p $pathToFolder
	cp -r ./* $pathToFolder
	
	pushd $pathToFolder > /dev/null
	./sed_parameters $MODEL_NAME $NP "openfoam" "$MESH" 
	
	g++ generate_blockMeshDict_file.c -o generate_blockMeshDict_file
	./generate_blockMeshDict_file "openfoam"
	blockMesh
	
	decomposePar
	mpirun -np $NP pisoFoam -parallel
	
	python3 convertDatToCSV.py
	python3 exportResults.py --inputname="postProcessing/forceCoeffs/0/coefficient.dat" --outputname="results_OF_$MESH.txt" --openfoam
	cat results_OF_$MESH.txt
	
	mpiexec -n $NP ~/programs/paraview_build/bin/pvbatch postProcScript.py 
	#paraview --script=postProcScript.py
	popd > /dev/null
done
